<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics in dark mode */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        /* Tooltip styles */
        #monster-tooltip {
            position: absolute;
            display: none;
            padding: 10px;
            background-color: #111827;
            border: 1px solid #374151;
            border-radius: 8px;
            color: #d1d5db;
            font-size: 0.875rem;
            z-index: 100;
            pointer-events: none; /* Allows mouse events to pass through */
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            min-width: 200px;
        }
        /* Expanding Search Bar Styles */
        .search-wrapper .search-input {
            transition: width 0.3s ease-in-out;
        }
        .search-wrapper:hover .search-input,
        .search-input:focus {
            width: 256px; /* w-64 */
        }
        /* Custom select styling */
        .filter-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="%239ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9l4 4 4-4"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1em;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300">

    <div id="sidebar"></div>

    <!-- Main Content -->
    <main id="main-content" class="p-4 md:p-8">
            <div id="content-container">
                <!-- Equipment Content (Visible by default) -->
                <section id="equipment" class="content-section">
                    <div class="flex flex-wrap items-center gap-4 mb-6">
                        <h1 class="text-3xl font-bold text-white">Equipment</h1>
                        <div class="search-wrapper relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                            <input type="search" id="equipment-search" class="search-input block w-10 h-10 p-2 pl-10 text-sm text-gray-300 bg-gray-700 rounded-full border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Search Equipment...">
                        </div>
                        <div class="relative">
                            <select id="equipment-type-filter" class="filter-select block w-48 h-10 px-4 text-sm text-gray-300 bg-gray-700 rounded-full border border-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 cursor-pointer">
                                <option value="all">All Types</option>
                            </select>
                        </div>
                    </div>
                    <div id="equipment-list"></div>
                </section>

                <!-- Cards Content (Hidden by default) -->
                <section id="cards" class="content-section hidden">
                     <div class="flex flex-wrap items-center gap-4 mb-6">
                        <h1 class="text-3xl font-bold text-white">Cards</h1>
                        <div class="search-wrapper relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                            <input type="search" id="cards-search" class="search-input block w-10 h-10 p-2 pl-10 text-sm text-gray-300 bg-gray-700 rounded-full border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500" placeholder="Search Cards...">
                        </div>
                       <div class="relative">
                            <select id="card-slot-filter" class="filter-select block w-48 h-10 px-4 text-sm text-gray-300 bg-gray-700 rounded-full border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 cursor-pointer">
                                <option value="all">All Slots</option>
                            </select>
                        </div>
                    </div>
                    <div id="cards-list"></div>
                </section>

                <!-- Artifacts Content (Hidden by default) -->
                <section id="artifacts" class="content-section hidden">
                    <div class="flex items-center mb-6">
                        <h1 class="text-3xl font-bold text-white">Artifacts</h1>
                        <div class="search-wrapper relative ml-4">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                            <input type="search" id="artifacts-search" class="search-input block w-10 h-10 p-2 pl-10 text-sm text-gray-300 bg-gray-700 rounded-full border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-teal-500" placeholder="Search Artifacts...">
                        </div>
                    </div>
                    <div id="artifacts-list"></div>
                </section>

                <!-- Monsters Content (Hidden by default) -->
                <section id="monsters" class="content-section hidden">
                    <div class="flex items-center mb-6">
                        <h1 class="text-3xl font-bold text-white">Monsters</h1>
                        <div class="search-wrapper relative ml-4">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                            <input type="search" id="monsters-search" class="search-input block w-10 h-10 p-2 pl-10 text-sm text-gray-300 bg-gray-700 rounded-full border border-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" placeholder="Search Monsters...">
                        </div>
                    </div>
                    <div id="monsters-list"></div>
                </section>
            </div>
        </main>
    </div>

    <!-- Tooltip Element -->
    <div id="monster-tooltip"></div>
    <script src="sidebar.js" defer></script>
    <script src="Equipment.js" defer></script>
    <script src="Cards.js" defer></script>
    <script src="Artifacts.js" defer></script>
    <script src="monsters.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Data is now loaded from the deferred scripts above.
            // Assign 'monsters' from monsters.js to 'monsterData' for compatibility with existing code.
            const monsterData = monsters;

            try {
                // --- UTILITY FUNCTIONS ---

                function parseStats(statString) {
                    if (!statString) return '<span class="text-gray-500">N/A</span>';
                    return statString
                        .replace(/<color=#([A-Fa-f0-9]{6})[A-Fa-f0-9]{2}>/g, (match, color) => `<span style="color:#${color};">`)
                        .replace(/<\/color>/g, '</span>')
                        .replace(/\n/g, '<br>');
                }

                function renderSources(item, themeColor) {
                    if (!item.Source) return '';

                    const sources = item.Source.split('\n');
                    const droprates = item.Droprate ? item.Droprate.split('\n') : [];
                    const locations = item.Location ? item.Location.split('\n') : [];

                    if (sources.length === 0) return '';

                    let sourcesHtml = `<div class="mt-4 pt-4 border-t border-gray-700/50 text-xs text-gray-400">`;

                    if (sources.length === 1 && sources[0] !== '') {
                         sourcesHtml += `<p>Source: <span class="monster-link font-semibold text-${themeColor}-400 cursor-pointer" data-monster-name="${sources[0]}">${sources[0]}</span> ${droprates[0] ? `(${droprates[0]})` : ''} in ${locations[0]}</p>`;
                    } else {
                        sourcesHtml += '<p class="text-xs text-gray-500 uppercase font-semibold mb-1">Sources</p><ul class="list-disc list-inside text-sm space-y-1">';
                        sources.forEach((source, index) => {
                            if (source === '') return;
                            const monsterName = source.replace(/^(Rune - |Gem - |Relic - |Scroll - )/, '');
                            sourcesHtml += `<li>
                                <span class="monster-link font-semibold text-${themeColor}-400 cursor-pointer" data-monster-name="${monsterName}">${source}</span>
                                ${droprates[index] ? `<span class="text-gray-400"> (${droprates[index]})</span>` : ''}
                                in ${locations[index]}
                            </li>`;
                        });
                        sourcesHtml += '</ul>';
                    }
                    sourcesHtml += '</div>';
                    return sourcesHtml;
                }

                // --- RENDERING FUNCTIONS ---

                function renderEquipmentList(data) {
                    const container = document.getElementById('equipment-list');
                    const itemsToRender = data || equipmentData;
                    container.innerHTML = `
                        <div class="grid grid-cols-[repeat(auto-fill,minmax(420px,1fr))] gap-4">
                            ${itemsToRender.map(item => `
                                <div class="bg-gray-800/70 rounded-lg border border-gray-700/50 p-4 flex flex-col transition-all hover:border-indigo-500/50 hover:shadow-2xl hover:shadow-indigo-500/10">
                                    <div class="flex items-start mb-3">
                                        <img src="https://placehold.co/64x64/1f2937/7c3aed?text=${item.Name.substring(0,1)}" alt="${item.Name}" class="w-12 h-12 rounded-md bg-gray-700 mr-4 flex-shrink-0">
                                        <div class="flex-1">
                                            <h3 class="font-bold text-lg text-white leading-tight">${item.Name}</h3>
                                            <div class="mt-1 flex items-center flex-wrap">
                                                <span class="inline-block bg-indigo-900/60 text-indigo-300 text-xs font-semibold px-2 py-0.5 rounded">${item.Type}</span>
                                                ${item.Set ? `<span class="ml-2 inline-block bg-gray-700 text-gray-300 text-xs font-semibold px-2 py-0.5 rounded">Set: ${item.Set}</span>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex-grow space-y-3 mb-4">
                                        ${item.PrimaryStats ? `<div><p class="text-xs text-gray-500 uppercase font-semibold">Primary Stats</p><p class="text-sm font-mono">${parseStats(item.PrimaryStats)}</p></div>` : ''}
                                        ${item.SecondaryStats ? `<div><p class="text-xs text-gray-500 uppercase font-semibold">Secondary Stats</p><p class="text-sm font-mono">${parseStats(item.SecondaryStats)}</p></div>` : ''}
                                        ${item.SetBonuses ? `<div><p class="text-xs text-gray-500 uppercase font-semibold">Set Bonus</p><p class="text-sm font-mono">${parseStats(item.SetBonuses)}</p></div>` : ''}
                                        <div><p class="text-xs text-gray-400">Card Slots: <span class="font-semibold text-indigo-400">${item.CardSlots}</span></p></div>
                                    </div>
                                    <div class="mt-auto">
                                        ${renderSources(item, 'indigo')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>`;
                }

                function formatCardDroprate(droprate) {
                    if (!droprate) return '';
                    const rate = parseFloat(droprate.replace('%', ''));
                    if (isNaN(rate)) return droprate;
                    // Adjust for floating point inaccuracies and remove unnecessary trailing zeros
                    return Number((rate / 100).toFixed(2)) + '%';
                }

                function renderCardsList(data) {
                    const container = document.getElementById('cards-list');
                    const itemsToRender = data || cardData;
                    container.innerHTML = `
                        <div class="grid grid-cols-[repeat(auto-fill,minmax(320px,1fr))] gap-4">
                            ${itemsToRender.map(card => `
                                <div class="bg-gray-800/70 rounded-lg border border-gray-700/50 p-4 flex flex-col transition-all hover:border-purple-500/50 hover:shadow-2xl hover:shadow-purple-500/10">
                                     <div class="flex items-start mb-3">
                                        <img src="Sprites/Cards/${card.Slot}.png" alt="${card.Slot} Card" class="w-12 h-12 rounded-md mr-2 flex-shrink-0" onerror="this.onerror=null;this.src='https://placehold.co/40x40/1f2937/a855f7?text=C'; this.classList.add('bg-gray-700');">
                                        <div class="flex-1">
                                            <p class="text-xs font-bold uppercase text-purple-400">${card.Affix}</p>
                                            <h3 class="font-bold text-lg text-white leading-tight">${card.Name}</h3>
                                            <div class="mt-1">
                                                <span class="inline-block bg-purple-900/60 text-purple-300 text-xs font-semibold px-2 py-0.5 rounded">${card.Slot}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex-grow mb-3">
                                        <p class="text-xs text-gray-500 uppercase font-semibold">Stats</p>
                                        <p class="text-sm font-mono">${parseStats(card.Stats)}</p>
                                    </div>
                                     <div class="mt-auto pt-4 border-t border-gray-700/50 text-xs text-gray-400 space-y-1">
                                        <p>Source: <span class="monster-link font-semibold text-purple-400 cursor-pointer" data-monster-name="${card.Source}">${card.Source}</span> (${formatCardDroprate(card.Droprate)})</p>
                                        <p>Location: ${card.Location}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>`;
                }

                function renderArtifactsList(data) {
                    const container = document.getElementById('artifacts-list');
                    const itemsToRender = data || artifactData;
                    container.innerHTML = `
                        <div class="grid grid-cols-[repeat(auto-fill,minmax(400px,1fr))] gap-4">
                            ${itemsToRender.map(artifact => `
                                <div class="bg-gray-800/70 rounded-lg border border-gray-700/50 p-4 transition-all hover:border-teal-500/50 hover:shadow-2xl hover:shadow-teal-500/10">
                                    <h3 class="font-bold text-xl text-white mb-3">${artifact.SetName} Set</h3>
                                    <div class="space-y-2">
                                        ${artifact.PerPieceBonus ? `<div><p class="text-xs text-gray-500 uppercase font-semibold">Per Piece Bonus</p><p class="text-sm font-mono">${parseStats(artifact.PerPieceBonus)}</p></div>` : ''}
                                        ${artifact.PerRefineBonus ? `<div><p class="text-xs text-gray-500 uppercase font-semibold">Per Refine Bonus</p><p class="text-sm font-mono">${parseStats(artifact.PerRefineBonus)}</p></div>` : ''}
                                        ${artifact.FullSetBonus ? `<div><p class="text-xs text-gray-500 uppercase font-semibold">Full Set Bonus</p><p class="text-sm font-mono">${parseStats(artifact.FullSetBonus)}</p></div>` : ''}
                                    </div>
                                    ${renderSources(artifact, 'teal')}
                                </div>
                            `).join('')}
                        </div>`;
                }

                function renderMonstersList(data) {
                    const container = document.getElementById('monsters-list');
                    const itemsToRender = data || monsterData;
                    container.innerHTML = `
                        <div class="bg-gray-800/70 rounded-lg border border-gray-700/50 overflow-hidden">
                            <table class="w-full text-left">
                                <thead class="bg-gray-800">
                                    <tr>
                                        <th class="p-4 text-xs font-semibold uppercase text-gray-400">Name</th>
                                        <th class="p-4 text-xs font-semibold uppercase text-gray-400">Level</th>
                                        <th class="p-4 text-xs font-semibold uppercase text-gray-400">Element</th>
                                        <th class="p-4 text-xs font-semibold uppercase text-gray-400">Map</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${itemsToRender.map((monster, index) => `
                                        <tr class="border-t border-gray-700/50 ${index % 2 === 0 ? 'bg-black/10' : ''}">
                                            <td class="p-4 font-medium text-white">${monster.MonsterName}</td>
                                            <td class="p-4 text-gray-300">${monster.Level}</td>
                                            <td class="p-4 text-gray-300">${monster.Element}</td>
                                            <td class="p-4 text-gray-300">${monster.Map}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>`;
                }

                // --- FILTERING AND SEARCHING LOGIC ---
                function applyFiltersAndSearch() {
                    // Equipment
                    const equipmentSearchTerm = document.getElementById('equipment-search').value.toLowerCase();
                    const equipmentTypeFilter = document.getElementById('equipment-type-filter').value;
                    let filteredEquipment = equipmentData;

                    if (equipmentTypeFilter !== 'all') {
                        filteredEquipment = filteredEquipment.filter(item => item.Type === equipmentTypeFilter);
                    }
                    if (equipmentSearchTerm) {
                        filteredEquipment = filteredEquipment.filter(item => {
                            const searchIn = [item.Name, item.PrimaryStats, item.SecondaryStats, item.SetBonuses, item.Type, item.Set, item.Source, item.Location].join(' ').toLowerCase();
                            return searchIn.includes(equipmentSearchTerm);
                        });
                    }
                    renderEquipmentList(filteredEquipment);

                    // Cards
                    const cardSearchTerm = document.getElementById('cards-search').value.toLowerCase();
                    const cardSlotFilter = document.getElementById('card-slot-filter').value;
                    let filteredCards = cardData;

                    if (cardSlotFilter !== 'all') {
                        filteredCards = filteredCards.filter(item => item.Slot === cardSlotFilter);
                    }
                    if (cardSearchTerm) {
                        filteredCards = filteredCards.filter(item => {
                            const searchIn = [item.Name, item.Stats, item.Source, item.Location, item.Affix, item.Slot].join(' ').toLowerCase();
                            return searchIn.includes(cardSearchTerm);
                        });
                    }
                    renderCardsList(filteredCards);
                }

                // --- POST-DATA-LOAD INITIALIZATION ---

                // Populate filters
                const equipmentTypeFilter = document.getElementById('equipment-type-filter');
                const uniqueEquipmentTypes = [...new Set(equipmentData.map(item => item.Type))].sort();
                uniqueEquipmentTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    equipmentTypeFilter.appendChild(option);
                });

                const cardSlotFilter = document.getElementById('card-slot-filter');
                const uniqueCardSlots = [...new Set(cardData.map(item => item.Slot))].sort();
                uniqueCardSlots.forEach(slot => {
                    const option = document.createElement('option');
                    option.value = slot;
                    option.textContent = slot;
                    cardSlotFilter.appendChild(option);
                });

                // Initial render
                renderEquipmentList();
                renderCardsList();
                renderArtifactsList();
                renderMonstersList();

                const contentSections = document.querySelectorAll('.content-section');
                const tooltip = document.getElementById('monster-tooltip');

                // --- HASH-BASED NAVIGATION ---
                function showSectionBasedOnHash() {
                    let targetId = window.location.hash.substring(1);
                    if (!targetId || !document.getElementById(targetId)) {
                        targetId = 'equipment';
                         // Update hash to reflect default view
                        if (window.location.pathname.endsWith('database.html') && !window.location.hash) {
                           history.replaceState(null, '', '#equipment');
                        }
                    }

                    // Toggle content visibility
                    contentSections.forEach(section => {
                        section.classList.toggle('hidden', section.id !== targetId);
                    });
                }

                showSectionBasedOnHash();
                window.addEventListener('hashchange', showSectionBasedOnHash);


                // Filter and Search event listeners
                document.getElementById('equipment-search').addEventListener('input', applyFiltersAndSearch);
                document.getElementById('equipment-type-filter').addEventListener('change', applyFiltersAndSearch);
                document.getElementById('cards-search').addEventListener('input', applyFiltersAndSearch);
                document.getElementById('card-slot-filter').addEventListener('change', applyFiltersAndSearch);

                document.getElementById('artifacts-search').addEventListener('keyup', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredData = artifactData.filter(item => {
                        const searchIn = [
                            item.SetName, item.PerPieceBonus, item.PerRefineBonus,
                            item.FullSetBonus, item.Source, item.Location
                        ].join(' ').toLowerCase();
                        return searchIn.includes(searchTerm);
                    });
                    renderArtifactsList(filteredData);
                });

                document.getElementById('monsters-search').addEventListener('keyup', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredData = monsterData.filter(item => {
                        const searchIn = [
                            item.MonsterName, item.Element, item.Map
                        ].join(' ').toLowerCase();
                        return searchIn.includes(searchTerm);
                    });
                    renderMonstersList(filteredData);
                });


                // Tooltip logic (delegated to the content container)
                document.getElementById('content-container').addEventListener('mouseover', (e) => {
                    if (e.target.classList.contains('monster-link')) {
                        const monsterName = e.target.getAttribute('data-monster-name');
                        const monsterInfo = monsterData.find(m => m.MonsterName === monsterName);

                        tooltip.innerHTML = monsterInfo
                            ? `<h4 class="font-bold text-white text-base mb-2">${monsterInfo.MonsterName}</h4>
                               <p><strong>Level:</strong> ${monsterInfo.Level}</p>
                               <p><strong>Element:</strong> ${monsterInfo.Element}</p>
                               <p><strong>Map:</strong> ${monsterInfo.Map}</p>`
                            : `<h4 class="font-bold text-white text-base mb-2">${monsterName}</h4>
                               <p class="text-gray-500">Details not found.</p>`;
                        tooltip.style.display = 'block';
                    }
                });

                document.getElementById('content-container').addEventListener('mouseout', (e) => {
                    if (e.target.classList.contains('monster-link')) {
                        tooltip.style.display = 'none';
                    }
                });

                document.addEventListener('mousemove', (e) => {
                    if (tooltip.style.display === 'block') {
                        tooltip.style.left = `${e.pageX + 15}px`;
                        tooltip.style.top = `${e.pageY + 15}px`;
                    }
                });

            } catch (error) {
                console.error("Failed to load game data:", error);
                document.getElementById('content-container').innerHTML = `<p class="text-red-400">Error loading data. Please ensure all data scripts are loaded correctly.</p>`;
            }
        });
    </script>
</body>
</html>